
# Lab 5 - NetFlow

This lab will include instructions for installing Ntopng on OPNsense, configuring behavioural checks of NetFlow data to be logged to Loki and taking a look at the Ntopng plugin for Grafana.

## Grading

Submit screenshots (including your student number):
  - showing the Ntopng "Hosts" dashboard
  - showing the Loki notification endpoint configuration
  - showing the Loki notification recipient configuration
  - showing the Ntopng plugin installed in your Grafana

## Install Redis plugin to OPNSense

1. Login to OPNsense and then navigate to System -> Firmware -> Plugins
2. Install os-redis plugin by clicking the button with the "+" icon
3. Refresh the webpage in your browser
## Install Ntopng plugin to OPNSense

1. Login to OPNsense and then navigate to System -> Firmware -> Plugins
2. Install os-ntopng plugin by clicking the button with the "+" icon
3. Refresh the webpage in your browser

## Enable Redis on OPNsense

1. Navigate to Services -> Redis
2. Enable the Redis service by clicking the checkbox
3. Click "Apply" to save your changes
4. Ensure that the service is started using the play icon in the top right of the page

## Enable Ntopng on OPNsense

1. Navigate to Services -> Ntopng
2. Enable the Ntopng service by clicking the checkbox
3. Click "Save" to save your changes
4. Ensure that the service is started using the play icon in the top right of the page

## Verify Ntopng OPNsense

Navigate to port 3000 on your OPNsense machine and login using credentials admin:admin.

    http://<opnsense_ip_address>:3000/

After logging in, take some time to explore the application. Generate some traffic to analyze by browsing to different webpages from your Fedora machine.

## Configure Loki notification endpoint

1. Navigate to Shortcuts -> Notifications -> Endpoints
2. Click the + icon to add a notification endpoint
3. Give the endpoints a name such as "Loki"
4. Notice the different types of endpoints that are supported
5. Select type "Syslog"
6. Select format "Text (RFC 5424)"
7. Configure the host to your Fedora machine's IP address
8. Configure the port and protocol to 514/tcp
9. Click "Add" to save the endpoint

## Configure Loki notification recipient

1. Navigate to Shortcuts -> Notifications -> Recipients
2. Click the + icon to add a notification endpoint
3. Give the recipient a name such as "Loki"
4. Select the endpoint you created in the previous step
5. Notice that you can filter the types of logs that are generated by check categories, check entities, host pools and active monitoring.
6. Click "Add" to save the recipient

## Add Ntopng Plugin to Grafana

1. Login to Grafana on port 3000 of your Fedora machine using credentials "admin:admin"
2. Navigate to Administration -> Plugins
3. Search for "Ntopng" then select it
4. Click "Install" to install the Ntopng plugin
